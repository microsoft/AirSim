<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>AirSim on Real Drones - AirSim</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "AirSim on Real Drones";
    var mkdocs_page_input_path = "docs\\custom_drone.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> AirSim</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../CHANGELOG/">Whats New</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Get AirSim</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../use_precompiled/">Download Binaries</a>
                </li>
                <li class="">
                    
    <a class="" href="../build_windows/">Build on Windows</a>
                </li>
                <li class="">
                    
    <a class="" href="../build_linux/">Build on Linux</a>
                </li>
                <li class="">
                    
    <a class="" href="../unreal_custenv/">Creating Custom Environment</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Using AirSim</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../apis/">Core APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../image_apis/">Image APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../apis_cpp/">C++ APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../dev_workflow/">Development Workflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../settings/">Settings</a>
                </li>
                <li class="">
                    
    <a class="" href="../camera_views/">Camera Views</a>
                </li>
                <li class="">
                    
    <a class="" href="../using_car/">Using Car</a>
                </li>
                <li class="">
                    
    <a class="" href="../remote_control/">Remote Control</a>
                </li>
                <li class="">
                    
    <a class="" href="../xbox_controller/">XBox Controller</a>
                </li>
                <li class="">
                    
    <a class="" href="../steering_wheel_installation/">Steering Wheel</a>
                </li>
                <li class="">
                    
    <a class="" href="../multi_vehicle/">Multiple Vehicles</a>
                </li>
                <li class="">
                    
    <a class="" href="../sensors/">Sensors</a>
                </li>
                <li class="">
                    
    <a class="" href="../lidar/">LIDAR</a>
                </li>
                <li class="">
                    
    <a class="" href="../ros/">ROS</a>
                </li>
                <li class="">
                    
    <a class="" href="../playback/">Playing Logs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Design</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../design/">Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../code_structure/">Code Structure</a>
                </li>
                <li class="">
                    
    <a class="" href="../coding_guidelines/">Coding Guidelines</a>
                </li>
                <li class="">
                    
    <a class="" href="../flight_controller/">Flight Controller</a>
                </li>
                <li class="">
                    
    <a class="" href="../simple_flight/">Simple Flight</a>
                </li>
                <li class="">
                    
    <a class="" href="../hello_drone/">Hello Drone</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">MavLink and PX4</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../px4_setup/">PX4 Setup for AirSim</a>
                </li>
                <li class="">
                    
    <a class="" href="../px4_sitl/">PX4 in SITL</a>
                </li>
                <li class="">
                    
    <a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim with Pixhawk</a>
                </li>
                <li class="">
                    
    <a class="" href="https://youtu.be/HNWdYrtw3f0">PX4 Setup with AirSim</a>
                </li>
                <li class="">
                    
    <a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">Debugging Attitude Estimation</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">Intercepting MavLink Messages</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">Rapid Descent on PX4 Drones</a>
                </li>
                <li class="">
                    
    <a class="" href="../px4_build/">Building PX4</a>
                </li>
                <li class="">
                    
    <a class="" href="../px4_logging/">PX4/MavLink Logging</a>
                </li>
                <li class="">
                    
    <a class="" href="../log_viewer/">MavLink LogViewer</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Upgrading</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../unreal_upgrade/">Upgrading Unreal</a>
                </li>
                <li class="">
                    
    <a class="" href="../upgrade_apis/">Upgrading APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../upgrade_settings/">Upgrading Settings</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Contributed Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../reinforcement_learning/">Reinforcement Learning</a>
                </li>
                <li class="">
                    
    <a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">Using Environments from Marketplace</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/simondlevy/AirSimTensorFlow">Simple Collision Avoidance</a>
                </li>
                <li class="">
                    
    <a class="" href="https://aka.ms/AutonomousDrivingCookbook">Autonomous Driving on Azure</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">Building Hexacopter</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">Moving on Path Demo</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Point-Clouds">Building Point Clouds</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Implementing-a-Drone-Survey-script">Surveying Using Drone</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Misc</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">AirSim on Real Drones</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#airlib-on-a-real-drone">AirLib on a Real Drone</a></li>
    

    <li class="toctree-l3"><a href="#droneserver-and-droneshell">DroneServer and DroneShell</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#px4-specific-tools">PX4 Specific Tools</a></li>
        
            <li><a class="toctree-l4" href="#how-does-this-work">How Does This Work?</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../cmake_linux/">Installing cmake on Linux</a>
                </li>
                <li class="">
                    
    <a class="" href="../hard_drive/">Tips for Busy HDD</a>
                </li>
                <li class="">
                    
    <a class="" href="../pfm/">pfm format</a>
                </li>
                <li class="">
                    
    <a class="" href="../unreal_proj/">Setting up Unreal Environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../unreal_blocks/">Blocks Environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../who_is_using/">Who is Using AirSim</a>
                </li>
                <li class="">
                    
    <a class="" href="../working_with_plugin_contents/">Working with UE Plugin Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/technion">Formula Student Technion Self-drive</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../faq/">FAQ</a>
                </li>
                <li class="">
                    
    <a class="" href="../../SUPPORT/">Support</a>
                </li>
                <li class="">
                    
    <a class="" href="../create_issue/">Create Issue</a>
                </li>
                <li class="">
                    
    <a class="" href="../../CONTRIBUTING/">Contribute</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">AirSim</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Misc &raquo;</li>
        
      
    
    <li>AirSim on Real Drones</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/microsoft/airsim/edit/master/docs/docs/custom_drone.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="airlib-on-a-real-drone">AirLib on a Real Drone</h1>
<p>The AirLib library can be compiled and deployed on the companion computer on a real drone. For our testing, we mounted a Gigabyte Brix BXi7-5500 ultra compact PC on the drone connected to the Pixhawk flight controller over USB. The Gigabyte PC is running Ubuntu, so we are able to SSH into it over Wi-Fi: </p>
<p><img alt="Flamewheel" src="../images/Flamewheel.png" /></p>
<p>Once connected you can run MavLinkTest with this command line:</p>
<pre><code>MavLinkTest -serial:/dev/ttyACM0,115200 -logdir:. 
</code></pre>

<p>And this will produce a log file of the flight which can then be used for <a href="../playback/">playback in the simulator</a>.</p>
<p>You can also add <code>-proxy:192.168.1.100:14550</code> to connect MavLinkTest to a remote computer where you can run QGroundControl or our 
<a href="../log_viewer/">PX4 Log Viewer</a> which is another handy way to see what is going on with your drone.</p>
<p>MavLinkTest then has some simple commands for testing your drone, here's a simple example of some commands:</p>
<pre><code>arm
takeoff 5
orbit 10 2
</code></pre>

<p>This will arm the drone, takeoff of 5 meters, then do an orbit pattern radius 10 meters, at 2 m/s.
Type '?' to find all available commands.</p>
<p><strong>Note:</strong> Some commands (for example, <code>orbit</code>) are named differently and have different syntax in MavLinkTest and DroneShell (for example, <code>circlebypath -radius 10 -velocity 21</code>).</p>
<p>When you land the drone you can stop MavLinkTest and copy the *.mavlink log file that was generated.</p>
<h1 id="droneserver-and-droneshell">DroneServer and DroneShell</h1>
<p>Once you are happy that the MavLinkTest is working, you can also run DroneServer and DroneShell as follows. First, run MavLinkTest with a local proxy to send everything to DroneServer:</p>
<pre><code>MavLinkTest -serial:/dev/ttyACM0,115200 -logdir:. -proxy:127.0.0.1:14560
</code></pre>

<p>Change ~/Documents/AirSim/settings.json to say "serial":false, because we want DroneServer to look for this UDP connection.</p>
<pre><code>DroneServer 0
</code></pre>

<p>Lastly, you can now connect DroneShell to this instance of DroneServer and use the DroneShell commands to fly your drone:</p>
<pre><code>DroneShell
==||=&gt;
        Welcome to DroneShell 1.0.
        Type ? for help.
        Microsoft Research (c) 2016.

Waiting for drone to report a valid GPS location...
==||=&gt; requestcontrol
==||=&gt; arm
==||=&gt; takeoff
==||=&gt; circlebypath -radius 10 -velocity 2
</code></pre>

<h2 id="px4-specific-tools">PX4 Specific Tools</h2>
<p>You can run the MavlinkCom library and MavLinkTest app to test the connection
between your companion computer and flight controller.  </p>
<h2 id="how-does-this-work">How Does This Work?</h2>
<p>AirSim uses MavLinkCom component developed by @lovettchris. The MavLinkCom has a proxy architecture where you can open a connection to PX4 either using serial or UDP and then other components share this connection. When PX4 sends MavLink message, all components receive that message. If any component sends a message then it's received by PX4 only. This allows you to connect any number of components to PX4 <a href="https://github.com/Microsoft/AirSim/blob/master/AirLib/include/vehicles/multirotor/controllers/MavLinkDroneController.hpp#L793">This code</a> opens a connection for LogViewer and QGC. You can add something more if you like.</p>
<p>If you want to use QGC + AirSim together than you will need QGC to let own the serial port. QGC opens up TCP connection that acts as a proxy so any other component can connect to QGC and send MavLinkMessage to QGC and then QGC forwards that message to PX4. So you tell AirSim to connect to QGC and let QGC own serial port.</p>
<p>For companion board, the way we did it earlier was to have Gigabyte Brix on the drone. This x86 full-fledged computer that will connect to PX4 through USB. We had Ubuntu on Brix and ran <a href="https://github.com/Microsoft/AirSim/tree/master/DroneServer">DroneServer</a>. The DroneServer created an API endpoint that we can talk to via C++ client code (or Python code) and it translated API calls to MavLink messages. That way you can write your code against the same API, test it in the simulator and then run the same code on an actual vehicle. So the companion computer has DroneServer running along with client code. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cmake_linux/" class="btn btn-neutral float-right" title="Installing cmake on Linux">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../reinforcement_learning/" class="btn btn-neutral" title="Reinforcement Learning"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2018 Microsoft Research</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/microsoft/airsim/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../reinforcement_learning/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../cmake_linux/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
